<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin - All Applications</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&family=Playfair+Display:wght@500&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary: #41486d;
      --secondary: #c8d7d6;
      --accent: #7f88e6;
      --light: #f0f4f9;
      --dark: #2f365a;
      --success: #4caf50;
      --error: #f44336;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--light);
      color: var(--dark);
      padding: 2rem;
    }

    .container {
      max-width: 100%;
      background-color: white;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
      overflow-x: auto;
    }

    h1 {
      font-family: 'Playfair Display', serif;
      font-size: 2.4rem;
      color: var(--primary);
      text-align: center;
      margin-bottom: 1.5rem;
      position: relative;
    }

    h1::after {
      content: '';
      display: block;
      width: 100px;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      margin: 0.6rem auto 0;
      border-radius: 2px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
      margin-top: 1rem;
    }

    thead {
      background-color: var(--primary);
      color: white;
    }

    th, td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid var(--secondary);
      vertical-align: top;
    }

    tbody tr:hover {
      background-color: #f7f3f2;
    }

    td pre {
      white-space: pre-wrap;
      word-break: break-word;
      margin: 0;
      font-family: inherit;
    }

    .actions {
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 6px 12px;
      border: none;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.2s;
    }

    .status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.85rem;
    }


    .btn.approve { background: var(--success); }
    .btn.approve:hover { background: #3e8e41; }

    .btn.decline { background: var(--error); }
    .btn.decline:hover { background: #d13228; }

    .btn.delete { background: var(--dark); }
    .btn.delete:hover { background: #1f2542; }

    @media (max-width: 992px) {
      table, thead, tbody, th, td, tr { display: block; }
      thead { display: none; }
      tr {
        background: white;
        margin-bottom: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }
      td {
        border: none;
        border-bottom: 1px solid #eee;
        padding: 1rem;
        position: relative;
      }
      td::before {
        content: attr(data-label);
        font-weight: 600;
        color: var(--primary);
        position: sticky;
        padding-right: 10px;
        left: 1rem;
        width: 40%;
      }
      td:last-child { border-bottom: none; }
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Adoption Form Submissions</h1>

  <table>
    <thead>
      <tr>
        <th>Name</th><th>Email</th><th>Phone</th><th>Residence</th>
        <th>Time Spent</th><th>Other Pets</th><th>Allergies</th><th>18+?</th>
        <th>Committed?</th><th>Info</th><th>Foster</th><th>Status</th><th>Actions</th>

      </tr>
    </thead>
    <tbody id="submissionBody"></tbody>
  </table>
</div>

<script>
  // Fetch submissions and populate table
  fetch("./get_submissions.php")
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById("submissionBody");
      data.forEach(row => {
        tbody.innerHTML += `
          <tr>
            <td data-label="Full Name:">${row.fullName}</td>
            <td data-label="Email:">${row.email}</td>
            <td data-label="Number:">${row.contactNumber}</td>
            <td data-label="Residence Type:">${row.residenceType}</td>
            <td data-label="Cat living Area:">${row.timeSpent}</td>
            <td data-label="Other Pets:">${row.otherPets}</td>
            <td data-label="Allergies:">${row.allergies}</td>
            <td data-label="18+?:">${row.ageVerification}</td>
            <td data-label="Committed?:">${row.commitment}</td>
            <td data-label="Additional note:"><pre>${row.additionalInfo || ""}</pre></td>
            <td data-label="Foster person name:">${row.fosterName || ""}</td>
            <td data-label="Status:">
              <span id="status-${row.id}" class="status-badge ${row.status}">
                ${row.status}
              </span>
            </td>
            <td class="actions">
              <button type="button" class="btn approve" onclick="approve(${row.id})">Approve</button>
              <button type="button" class="btn decline" onclick="decline(${row.id})">Decline</button>
              <button type="button" class="btn delete" onclick="deleteEntry(${row.id})">Delete</button>
            </td>
          </tr>
        `;
      });
    })
    .catch(err => console.error("Failed to load submissions:", err));

  function approve(id){
    fetch("approve.php", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: "id=" + encodeURIComponent(id)
    })
    .then(res => res.text())
    .then(data => { console.log(data); location.reload(); });
  }

  function decline(id){
      fetch("decline.php", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: "id=" + encodeURIComponent(id)
      })
      .then(res => res.text())
      .then(data => { console.log(data); location.reload(); });
  }


  function deleteEntry(id){
    if(!id) {
        console.error("No ID provided to deleteEntry");
        return;
    }

    if(confirm("Are you sure you want to delete this?")){
        fetch("delete.php", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: "id=" + encodeURIComponent(id)
        })
        .then(res => res.text())
        .then(data => {
            console.log("Delete response:", data);
            location.reload();
        });
    }
  }
</script>
</body>
</html>
